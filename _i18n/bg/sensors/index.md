---
layout: default
title: Sensors
nav_order: 7
has_toc: false # on by default
usemathjax: true
has_children: true
usetocbot: true
lang: bg
---
# {{ page.title }}
{: .no_toc } ## Съдържание {: .no_toc .text-delta } 1. СЪДЪРЖАНИЕ {:toc} --- От ранна възраст ни учат на петте основни човешки сетива: допир, зрение, слух, обоняние и вкус. Но не се замисляме често колко сложна и удивително сложна е човешката сензорна система - от най-големия ни орган, кожата ни, която може да усеща температура и различни тактилни стимули (натиск, текстура, вибрации), до очите ни и зрителните нерви, които могат динамично да се фокусират, да се адаптират към нивата на осветление и дори да помагат за предварителното разпознаване на движещи се обекти и други форми. И тази взаимосвързана мрежа от сензори функционира в реално време, предавайки информация на мозъка за обработка и анализ. Удивително! И все пак, не можем да усетим всичко. Делфините и прилепите използват [ехолокация](https://en.wikipedia.org/wiki/Animal_echolocation), за да се ориентират и хранят, използвайки високочестотни звукови импулси, някои риби използват [електролокация](https://en.wikipedia.org/wiki/Passive_electrolocation_in_fish), за да се ориентират в мътни води, като генерират електрически полета и откриват изкривявания в тези полета [използвайки електрорецепторни органи](https://en.wikipedia.org/wiki/Electroreception), някои змии имат инфрачервено зрение, което им позволява да виждат през нощта, а други животни имат способността да усещат и откриват магнитно поле, за да възприемат посока, височина или местоположение (наречено [магниторецепция](https://en.wikipedia.org/wiki/Magnetoreception)).<!-- maybe include some creative commons or wikimedia pictures here? --> Дори за сетивата, които имаме – колкото и забележителни да са те – нашите сетива никога няма да бъдат толкова прецизни или изтънчени, колкото зрението на ястреб, обонянието на вълк или слуха на котка. И дори тогава има много повече неща за усещане в света, отколкото биологичните сензори. За изчисленията сензорите предоставят начин за достъп до информация за света, човешката дейност и отвъд него. А електронните сензори не се ограничават само до биологията – колкото и удивителна и разнообразна да е тя – а по-скоро до нашата собствена изобретателност да измисляме начини за улавяне на света. Това е невероятно вълнуващо предизвикателство! С напредъка в сензорните технологии като [MEM](https://en.wikipedia.org/wiki/Microelectromechanical_systems), изчисленията (съхранение на данни, работа в мрежа, носими устройства) и в обработката и машинното обучение, сега е завладяващо време да помислим и изучим ролята на сензорите в едно все по-компютърно общество. Как новите сензорни и обработващи системи могат да помогнат за идентифицирането на ракови клетки, да намерят нови животоподдържащи планети или да променят начина, по който взаимодействаме фундаментално със самите изчисления (например капацитивни сензорни екрани на таблети и телефони!)? <!-- primary learning goals: expose to certain types of sensors, how to use them, how to process them? how to make some yourself? --><!-- There's also an interesting potential sub-section here--especially since we are teaching HCI and human-oriented engineering--in talking about how human's sense and translate sensations. The Weber-Fechner Law relates to human perception: the change in a physical stimulus and the perceived change (also relates to JND: https://en.wikipedia.org/wiki/Weber%E2%80%93Fechner_law)>

## Introduction to Sensors

Humans have invented thousands of sensors. How should we organize and characterize them? There are numerous pragmatic factors, including reliability, precision, manufacturing cost, availability, power usage, and designer familiarity—all important. However, for our purposes, we will focus on three characteristics:

1. **What** a sensor does (its function)
2. **How** it senses (passively or actively)
3. **What output** it provides 

### Characterizing sensors by function

Perhaps the most intuitive scheme is organizing sensors by function. Wikipedia lists [hundreds of sensors](https://en.wikipedia.org/wiki/List_of_sensors) in broad categories, including:

1. Acoustic, sound, and vibration
2. Moisture and humidity
3. Flow and fluid velocity
4. Optical, light, and imaging
5. Thermal, heat, and temperature
6. Position, angle, displacement, distance, and more 

Other categorizations are also possible: Platt's 3rd volume of "Encyclopedia of Electronic Components", for example, categorizes sensors into spatial, mechanical, fluid, radiation, and electricity ([link](https://learning.oreilly.com/library/view/encyclopedia-of-electronic/9781449334307)). 

<!-- Regardless of functional categorization, we will only cover a small fraction here.

But first, let's break sensors down by **how** they sense and **what** output they provide. --> В допълнение към **какво** прави един сензор, можем да го характеризираме по **как** усеща и **какъв** изход предоставя. ### Пасивно срещу активно наблюдение Има два основни класа сензори: активни и пасивни. **Активните** сензори изискват външно захранване (и следователно ще имат Vcc пин и GND), докато **пасивните** сензори не. Да, това е. Това е ключовата разлика! Например, популярният 3-осен акселерометър [ADXL335](https://www.adafruit.com/product/163) е **активен** сензор: той има Vin, GND и три аналогови изхода (Xout, Yout и Zout), които преобразуват ускорението по всяка ос в ратиометрични (пропорционални) нива на напрежение. За разлика от това, [термисторът](https://en.wikipedia.org/wiki/Thermistor) е пасивен сензор: той променя съпротивлението си в отговор на топлина, което може да се използва за изчисляване на температурата. Някои активни сензори предават сигнал и след това анализират някакво отразено свойство на този сигнал за наблюдение. Например, инфрачервен (IR) сензор за близост, като [Sharp GP2Y0A21YK](https://www.sparkfun.com/products/242), съдържа както инфрачервен (IR) предавател, така и IR приемник. Сензорът изчислява разстоянието, като предава IR лъч и измерва ъгъла на отражение обратно върху IR приемника. По подобен начин, ултразвуков сензор за разстояние, като популярния [HC-SR04](https://www.sparkfun.com/products/15569), предава ултразвукови импулси и слуша за отразени ултразвукови вълни. Свързан микроконтролер може след това да изчисли разстоянието между сензора и обекта, отразяващ звука, като използва скоростта на звука през въздуха. ![Ултразвукова диаграма](assets/images/UltrasonicDiagram_Wikipedia.png) Ултразвуковите сензори за разстояние са вид **активен** сензор, състоящ се както от предавател, така и от приемник. Те работят, като предават ултразвуков импулс, който се отразява частично обратно от обекти по пътя на звуковата вълна (ако има такива). Чрез измерване на времето между предаването на импулса и приемането на ехото, може да се определи разстоянието. {: .fs-1 } Активните сензори могат също да включват сложен (но малък) вграден хардуер за противодействие на дрейфа на сензора, за филтриране/изглаждане на сигнала и/или за комуникация на изхода чрез цифров комуникационен протокол като [I2C](https://en.wikipedia.org/wiki/I%C2%B2C). За разлика от това, **пасивен** сензор генерира изходен сигнал въз основа на някакъв външен стимул и не изисква външно захранване. Например, [фоторезистор](https://en.wikipedia.org/wiki/Photoresistor) променя съпротивлението си в отговор на светлина, [термистор](https://en.wikipedia.org/wiki/Thermistor) в отговор на температура и [силово-чувствителен резистор](https://en.wikipedia.org/wiki/Force-sensing_resistor) в отговор на налягане. Разбира се, имаме нужда от захранвана верига, за да „извличаме“ информация от сензора – като делител на напрежение – но основният сензор реагира на явленията в околната среда, независимо от приложената мощност. Проста евристика за разграничаване на активните от пасивните сензори е преброяването на пиновете: активните сензори имат поне три пина (един за Vin, един за GND и поне един за изход), докато пасивните сензори имат два.<!-- TODO: in future add in a sub-section on MEMS because it's so AWESOME! : --> ### Изход на сензора Сензорите извеждат аналогови, двоични (вкл./изкл.) или цифрови сигнали (*напр.* [SPI](https://en.wikipedia.org/wiki/Serial_Peripheral_Interface)). Да, „двоичен“ е вид цифров изход, но си струва да се прави разлика. #### Аналогов изход Чисто аналоговите сензори включват резистивни сензори, като гореспоменатите термистори и фоторезистори, които **променят съпротивлението си** въз основа на някои стимули, както и ратиометрични сензори като гореспоменатия акселерометър [ADXL335](https://learn.adafruit.com/adafruit-analog-accelerometer-breakouts/overview) или сензора с ефект на Хол [DRV5055](https://www.ti.com/product/DRV5055), като и двата променят линейно изходното си напрежение в отговор на някои стимули – в този случай съответно ускорение и магнитни полета. #### Цифров изход Много съвременни сензори са базирани на чипове и включват известна вградена обработка. Тези сензори обработват и преобразуват суровите аналогови сигнали в цифров изход. Този изход се съхранява в памет (наречена регистър) на самия сензорен чип и се осъществява достъп от микроконтролер чрез комуникационен протокол като [I2C](https://en.wikipedia.org/wiki/I%C2%B2C) и [SPI](https://en.wikipedia.org/wiki/Serial_Peripheral_Interface). Например, за разлика от акселерометъра [ADXL335](https://learn.adafruit.com/adafruit-analog-accelerometer-breakouts/overview), който извежда напрежение, пропорционално на ускорението на всяка ос на пинове X, Y и Z, акселерометърът [LIS3DH](https://www.adafruit.com/product/2809) комуникира през I2C или SPI. Често доставяме единия или другия в нашите хардуерни комплекти. Тъй като LIS3DH поддържа протокол за цифрова комуникация (както I2C, така и SPI), можете да конфигурирате хардуера на сензора чрез код (*напр.* да зададете [диапазон на ускорение](https://learn.adafruit.com/adafruit-lis3dh-triple-axis-accelerometer-breakout/arduino) от +-2g до +-16g). Това е хубаво предимство на сензорите с вградени чипове, но може също така да увеличи цената им. | ADXL335 Акселерометър | LIS3DH Акселерометър | | --------------------- | -------------------- | | ![Снимка на ADXL335 - 5V готов триосен акселерометър (+-3g аналогов изход)](assets/images/ADXL335_Accelerometer_Adafruit.png) | ![Adafruit LIS3DH Триосен Акселерометър (+-2g/4g/8g/16g)](assets/images/LIS3DH_Accelerometer_Adafruit.png) | <!--TODO: add a bit on advantages vs. disadvnatages of analog vs. digital sensors: for example, with a digital communication protocol like SPI, can have error correction, etc. --> #### Двоичен изход И накрая, някои „сензори“ са или включени, или изключени (което може да се тълкува като вид прост цифров изход, но не е специално кодиран за микроконтролер, така че не се квалифицира като „цифров сигнал“ в нашата таксономия). Например, [рийд превключватели](https://en.wikipedia.org/wiki/Reed_switch) се затварят при наличие на магнитно поле, а [накланящи се сферични превключватели](https://www.adafruit.com/product/173) са кухи тръби със затворена проводима сфера, която се движи, за да затвори вътрешните контакти при определени ориентации (или накланяния) на тръбите.<!-- TODO: would be nice to have either lil animations of these or video snippets --> [Platt](https://learning.oreilly.com/library/view/encyclopedia-of-electronic/9781449334307) предоставя още по-задълбочено разпределение на типовете изходи на сензори, включително отворени колектори и сензори, които променят тока, а не напрежението. Вижте неговата книга за подробности. ### Оценка на сензор Има редица важни критерии при оценката на възможностите на сензора, включително: * **Честота на дискретизация**: Колко бързо сензорът предоставя изход? * **Разделителна способност**: Каква е най-малката промяна във физическото количество, което сензорът може да идентифицира? * **Грешка на квантуване**: Каква е грешката, причинена от закръгляването поради дигитализиране на аналоговите данни в ADC? Вижте раздела *Кръвопровод за получаване на сигнал* по-долу. * **Абсолютна грешка**: Каква е разликата между показанията на сензора и истинското физическо количество? * **Дрейф**: Как се променя абсолютната грешка с течение на времето по време на работа на сензора? * **Стабилност на околната среда**: Как се променя сензорът в отговор на разликите в температурата или влагата? ## Процес на придобиване на сигнал Нека разгледаме целия процес на придобиване на сигнал от суровия физически сигнал до дигитализираното му представяне. Ще научим повече за сигналите и обработката на сигнали в уроците [Сигнали](../signals/index.md). 1. Първо, съществуват някои физически явления, които съществуват в света (Етап 1). 2. Трябва да разработим и/или използваме метод за усещане на тези явления и извеждане на електрически сигнал (който ще може да се чете от компютър) (Етап 2). 3. Някои сензорни чипове обработват този електрически сигнал (*напр.* изглаждат, филтрират, усилват) – Етап 3. 4. В Етап 4, аналогово-цифров преобразувател (ADC) преобразува електрическия сигнал в битове (процес, наречен квантуване). 5. Накрая, в Етап 5, можем да обработим и анализираме дигитализирания сигнал, използвайки техники за цифрова обработка на сигнали (DSP) и машинно обучение, ура! ![Кръвопровод за събиране на сигнали, преминаващ от физически сигнал към сензор, за да го обработи, да преобразува и да преобразува аналогово-цифровия преобразувател (ADC) и да получи компютър](assets/images/SignalAcquisitionPipeline_Wikipedia.png) Блокова схема от статията в Уикипедия [&quot;Събиране на данни&quot;](https://en.wikipedia.org/wiki/Data_acquisition). [Директна връзка](https://en.wikipedia.org/wiki/File:DigitalDAQv2.pdf). {: .fs-1 } ### Някои съображения за събиране на сигнали При избора на сензори и канал за обработка на данни има множество съображения, включително: - **Честота на дискретизация.** Колко често се променя целевият физически сигнал? Колко бързо може да реагира вашият сензор? Има ли значение тази честота на отговор? Например, един фоторезистор реагира на ярка светлина за няколко милисекунди и може да се нуждае от повече от една секунда, за да възстанови съпротивлението си на тъмно, докато фототранзисторът и фотодиодът реагират по-бързо (вижте [Platt](https://learning.oreilly.com/library/view/encyclopedia-of-electronic/9781449334307/ch20.html#SECTION_PHOTORESISTOR)). - **Скорост на преобразуване на ADC** Колко бързо вашият микроконтролер може да вземе проби от сигнала и да извърши аналогово-цифровото преобразуване? - **Точност на ADC** Каква точност на ADC ви е необходима? Микроконтролерът ATmega328 използва 10-битов ADC. Така че по подразбиране диапазонът на напрежение от 0-5V е картографиран на 0-1023 $$2^10$$ и по този начин разделителната способност между показанията е 5V / 1024 или 0,0049 волта (4,9 mV). Ако се нуждаете от по-голяма прецизност – тоест, промените в изхода на сензора &lt; 0,0049V са важни – тогава трябва или да промените [`analogReference`](https://www.arduino.cc/reference/en/language/functions/analog-io/analogreference/) или ви е необходим различен аналогово-цифров преобразувател (ADC). Разликата между суров непрекъснат сигнал и неговата дигитализирана версия се нарича грешка на квантуване. <!-- TODO: Where to talk about quantization error? https://en.wikipedia.org/wiki/Quantization_(signal_processing) or quantization in general? --><!-- TODO: consider moving signal acquisition pipeline into the Signals section? --> ### Теорема за семплиране на Найкуист Една от най-важните (и интересни!) теореми в DSP е [*Теоремата за семплиране на Найкуист-Шанън*](https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem), която гласи, че непрекъснат времеви сигнал (суровият физически сигнал) може да бъде семплиран и перфектно реконструиран, ако честотата на семплиране (понякога наричана честота на семплиране или $$F_s$$) е над два пъти по-бърза от най-високочестотния компонент на суровия сигнал. Тоест, минималната честота на семплиране $$min(F_s)$$ трябва да бъде по-голяма от $$2 * max(F_{signal})$$. Например, често срещана честота на семплиране на цифровия звук е [44 100 Hz](https://en.wikipedia.org/wiki/44,100_Hz) (44,1 kHz). Това се използва от компактдискове (CD) и е стандартно и за mp3 файлове. Защо 44,1 kHz? Тази честота на семплиране е избрана отчасти защото диапазонът на човешкия слух е от ~20 Hz до 20 kHz. Следователно, съгласно горната теорема, минималната честота на семплиране трябва да бъде поне $$2 * 20 kHz$$ или 40 kHz. За да научите повече за теоремата за семплиране на Найкуист, заедно с конкретни, интерактивни примери, моля, вижте нашия [Бележник за квантуване и семплиране на Jupyter](../signals/QuantizationAndSampling/index.html). <!-- TODO: make interactive visualization that shows off Nyquist and its effect. Perhaps show two graphs: on left, the real signal with circles that represent sampling points. And then, on the right, the resulting signal. Update: I've now done this here https://makeabilitylab.github.io/physcomp/signals/QuantizationAndSampling/index.html --> ### Честота на преобразуване на ADC на ATmega328 ADC на ATmega328 изисква входна тактова честота между 50kHz и 200kHz (Раздел 24.4 от [текст с данни](http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf)). Нормалното преобразуване отнема 13 тактови цикъла на ADC (въпреки че първото преобразуване отнема 25 тактови цикъла на ADC, за да инициализира аналоговата схема). Процесорът и ADC на ATmega328 споделят един и същ тактов цикъл; тактовият цикъл на микроконтролера обаче е твърде бърз (16MHz) за ADC, така че можете да контролирате &quot;предделител&quot;, за да разделите тактовата честота на процесора в приемлив диапазон (делителите са 2, 4, 8, 16, 32, 64, 128). По подразбиране, библиотеката на Arduino задава предделителя на 128 (16MHz/128 = 125 KHz) в `wiring.c` (чрез задаване на бит в конфигурационен регистър). Тъй като преобразуването отнема 13 такта на ADC, честотата на семплиране е около 125KHz/13 или **9600 Hz**. И това не отчита натоварването на другия код, изпълняван на микроконтролера. Достатъчно бързо ли е това? За по-голямата част от сензорите, ориентирани към човека, да! Например, видеоигрите са насочени към честота на опресняване от 60 fps (60Hz), а времето за човешка реакция е ~150-250 ms (~4 Hz). Така че, 9600Hz е изключително бързо в сравнение! За семплиране на звук обаче, 9600Hz е в долния край. Припомнете си, че повечето цифрови музикални файлове имат честота на семплиране от 44,1 kHz - 4,6 пъти по-бърза от 9600Hz на ATmega328. При 9600Hz максималната разпознаваема честота в звуковата вълна би била 4800Hz. Ще разгледаме това по-подробно в частта [Сигнали](../signals/index.md) на класа. Забележка: Възможно е да семплирате ATmega328 с по-висока скорост, но с цената на точността. Техническият лист на ATmega328 предупреждава, че ако входната тактова честота на ADC надвиши 200kHz, тогава не всички 10 бита за преобразуване може да са готови (може би само първите 8 бита или по-малко). Ако искате да научите повече за по-бързите аналогови четения на Arduino, Open Music Labs са изследвали компромисите между скоростта и качеството на ADC на ATmega328 [тук](http://www.openmusiclabs.com/learning/digital/atmega-adc/index.html) и [тук](http://www.openmusiclabs.com/learning/digital/atmega-adc/index.html). В допълнение, тази [публикация в блога](http://yaab-arduino.blogspot.com/2015/02/fast-sampling-from-analog-input.html) говори за използването на &quot;ADC Free Running mode&quot; с прекъсвания, за да се получи честота на дискретизация от 76.8 KHz (а също така има връзки [тук](https://sites.google.com/site/qeewiki/books/avr-guide/analog-input)).<!-- See also: http://ee-classes.usc.edu/ee459/library/documents/ADC.pdf --> ### Резолюция на ADC на ATmega328 По подразбиране, резолюцията на ADC на ATmega328 е 10 бита (0-1023) в диапазона 0-5V. Това е резолюция от 4.88mV (най-малката разпознаваема стъпка на напрежение). Можете да промените това, ако не се нуждаете от пълния диапазон 0-5V. Всъщност, библиотеката на Arduino поддържа промяна на диапазона на ADC от стойността по подразбиране $$0-5V$$ на $$0-X$$, където $$X$$ е всяка стойност между 1.0V и $$V_{cc}$$ (което е 5V на Uno). Можете да направите това чрез [`analogReference`](https://www.arduino.cc/reference/en/language/functions/analog-io/analogreference/) функция. Това може да е полезно, например, ако знаете, че изходното напрежение на вашите сензори е в диапазона между 0-3.3V, тогава настройката `analogReference(EXTERNAL)` и прилагане на 3.3V към `AREF` Пин на Arduino подобрява разделителната способност на ADC от 4.9mV на 3.2mV. [Tronixstuff.com](https://tronixstuff.com/2013/12/12/arduino-tutorials-chapter-22-aref-pin/) има хубав урок за AREF. ## Нека правим неща! С това, нека направим някои неща със сензори! Уроците по-долу предполагат, че сте завършили и двете ни серии [Въведение в изхода](../arduino/intro-output.md) и [Въведение във входа](../arduino/intro-input.md). ### Сила Научете как да усещате сила с помощта на [резистор, чувствителен към сила (FSR)](../arduino/force-sensitive-resistors.md). Това направихте в серията [Въведение във входа](../arduino/intro-input.md). ### Светлина Научете как да усещате светлина с помощта на [фоторезистор (известен още като фотоклетка)](photoresistors.md). ### Магнитни полета Научете как да усещате магнитни полета с помощта на [сензор на Хол](hall-effect.md). ### Разстояние Научете как да усещате разстояние (2-400 см), използвайки [ултразвуков сензор за разстояние HC-SR04](https://www.makerguides.com/hc-sr04-arduino-tutorial/) ### Звук Научете как да усещате звук с помощта на [електретен микрофон](https://www.adafruit.com/product/1063) с усилвател MAX4466. ### Акселерометър Научете как да усещате ускорение с помощта на [3-осен акселерометър LIS3DH](https://learn.adafruit.com/adafruit-lis3dh-triple-axis-accelerometer-breakout/overview). <!-- ### Human related I/O
For human related I/O, human reaction time to an external stimulus is ~150-300ms (try a [human benchmark](https://www.humanbenchmark.com/tests/reactiontime)) and modern monitors refresh at 60Hz

Joysticks are often made from poteniometers like this one: https://www.adafruit.com/product/2765 and this one: https://www.adafruit.com/product/245

See: https://gamedev.stackexchange.com/a/30289 --><!-- ## Lesson possibilities
- Force: FSR
- Light: photocell
- Movement: Accel
- Movement 2: IMU
  - CSE590 VR had some slides on IMU, gyro, and accel: https://courses.cs.washington.edu/courses/cse490v/20wi/uwnetid/lecture9.pdf
  - https://courses.cs.washington.edu/courses/cse490v/20wi/uwnetid/lecture10.pdf
- Distance: Ultrasonic
- Magnetic field: hall effect
- Sound: microphone -->
